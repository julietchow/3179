{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800, "height": 300,
  "data": {"url":"https://raw.githubusercontent.com/julietchow/3179/main/data/stacked_area_chart.csv"},
  "title": {
      "text": "Energy Consumption by Energy Source",
      "fontSize": 14
  },
  "params":[
    {
      "name": "select_continent",
      "value": "Total",
      "bind": {
        "input": "select",
        "options": [
          "Total",
          "Africa",
          "Asia",
          "Oceania",
          "South America",
          "Antarctica",
          "Europe",
          "North America"
        ],
        "labels": [
          "All",
          "Africa",
          "Asia",
          "Oceania",
          "South America",
          "Antarctica",
          "Europe",
          "North America"
        ],
          "name": "Continent : "
      }
    }
  ],
  "transform": [
      {"filter": "datum.Continent == select_continent"}
  ],
  "encoding": {
      "x": {
        "timeUnit": "year", "field": "Year",
        "axis": {"format": "%Y", "grid": false, "title":"Year"},
        "title": "",
        "type": "temporal"
      }
  },
  "layer":[
      {
          "encoding": 
          {
              "y": {
              "aggregate": "sum",
              "field": "count",
              "title": "Energy Consumption Per Capita (Sextillion kWh)"
              },
              "color": {
              "field": "Energy Source",
              "scale": {
                  "domain": ["Coal","Natural Gas","Nuclear & Renewables","Petroleum"],
                  "range":["#DE6049","#D0DEB4","#FCF4EC","#3B739B"]
              },
              "legend" : {"title": "Energy Sources (Sextillion kWh)"}
              }
          },
          "layer":
          [
              {
                  "mark": {"type":"area"},
                  "params": 
                  [
                      {
                          "name": "energy_source",
                          "select": {"type": "point", "fields": ["Energy Source"]},
                          "bind": "legend"
                      }
                  ],
                  "encoding":{
                      "opacity": {
                          "condition": {
                              "param": "energy_source", 
                              "value": 1
                          },
                          "value": 0.2
                      }
                  }
              },
              {
                  "transform": [{"filter": {"param": "hover", "empty": false}}],
                  "mark": {"type": "area", "line": false, "point": true},
                  "encoding": {
                      "color": {
                      "field": "Energy Source",
                      "type": "nominal"
                      },
                      "opacity": {
                          "condition": {
                              "param": "energy_source", 
                              "value": 1
                          },
                          "value": 0.2
                      }
                  }
              }
          ]
      },
      {
          "transform": [
              {
                  "pivot": "Energy Source",
                  "value": "count",
                  "groupby": ["Year"]
              }
          ],
          "mark": "rule",
          "encoding": {
              "x":{
                  "field": "Year",
                  "axis": {"domainColor": "white", "labelColor": "white", "tickColor": "white"}
              },
              "opacity": {
                  "condition": {
                      "value": 0.3, 
                      "param": "hover", 
                      "empty": false
                  },
                  "value": 0
              },
              "tooltip": [
                  {"field": "Year","type":"temporal","format":"%Y"},
                  {"field": "Coal","type":"quantitative","format":",.2f"},
                  {"field": "Natural Gas","type":"quantitative","format":",.2f"},
                  {"field": "Nuclear & Renewables","type":"quantitative","format":",.2f"},
                  {"field": "Petroleum","type":"quantitative","format":",.2f"}
              ]
          },
          "params": [
              {
                  "name": "hover",
                  "select": {
                      "type": "point",
                      "fields": ["Year"],
                      "nearest": true,
                      "on": "mouseover",
                      "clear": "mouseout"
                  }
              }
          ]
      },
      {
          "data": {"values": [{"anot_x": 1000}]},
          "mark": {"type": "text", "dx": 784, "dy": 0, "fontWeight":"bold"},
          "encoding": {
              "text": {"value": "Notable Declines:"},
              "x": {
                  "field": "anot_x",
                  "type": "quantitative",
                  "axis": null
              },
              "color": {"value": "black"}
          }
      },        
      {
          "data": {"values": [{"anot_x": 1000}]},
          "mark": {"type": "text", "dx": 813, "dy": 15},
          "encoding": {
              "text": {"value": "2008-2009 Financial Crisis and"},
              "x": {
                  "field": "anot_x",
                  "type": "quantitative",
                  "axis": null
              },
              "color": {"value": "black"}
          }
      },        
      {
          "data": {"values": [{"anot_x": 1000}]},
          "mark": {"type": "text", "dx": 816, "dy": 30},
          "encoding": {
              "text": {"value": "2019-2020 COVID-19 Pandemic"},
              "x": {
                  "field": "anot_x",
                  "type": "quantitative",
                  "axis": null
              },
              "color": {"value": "black"}
          }
      }
  ]
}